{% extends 'blog/blog_base.html' %}
{% load blog i18n %}

{% block blog-nav %}
  <li><a href="{% url 'blog:post_new' %}">{% trans 'New Post' %}</a></li>
  <li><a href="{% url 'blog:post_draft_list' %}">{% trans 'Drafts' %}</a></li>
{% endblock blog-nav %}

{% block head_title %}
  <h2 class="section-title">Blog Posts</h2>
{% endblock head_title %}

{% block content %}
  <div class="blog">
    {% for post in post_list %}
      <div class="post-list">  
        <div class="post-header">
          <h1><a href="{% url 'blog:post_detail' pk=post.pk %}">
            {{ post.title }}</a></h1>
          <p><em> Published on: </em>
             <strong>{{ post.published_date|date:"d M Y"}}</strong></p>
        </div>
        <div class="post-body">
          {{ post.text|truncatechars:200 }}
        </div>
        {% if post.approve_comments.count != 0 %}
          <p><a href="{% url 'blog:post_detail' pk=post.pk %}">
            Comments: {{ post.approve_comments.count }}</a></p>
        {% else %}
        <br>
        {% endif %}
      </div>
      <hr>
    {% endfor %}

  </div>
{% endblock content %}

<!-- Sidebar on Blog List page -->
{% block extra %}
  <div class="blog-extra">
    <h3>Handy Links</h3>
    <ul>
      <li><a href="{% url 'blog:post_feed' %}"
            title="{% trans "RSS feed of last entries" %}"
            class="feeds">
          {% trans "Subscribe to my RSS feed" %}
        </a></li>
    </ul>
      
    <!-- Latest Posts -->
    <h3>Latest Posts</h3>
    {% show_latest_posts %}

    <!-- Popular Posts -->
    <h3>Popular Posts</h3>
    {% show_popular_posts as popular_posts %}
    <ul>
      {% for post in popular_posts %}
        <li><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></li>
      {% endfor %}
    </ul>

    <!-- Actions Needed -->
    {% total_draft_posts as draft_posts%}
    {% total_unapproved_comments as unapproved_comments%}

    {% if draft_posts >= 0 %}
    <h4>Actions Needed</h4>
      <ul>
        <p>You have <strong>{{ draft_posts }}</strong> unpublished draft.</p>
        <p>You have <strong>{{ unapproved_comments }}</strong> posts with unapproved comments.</p>
      </ul>
      
    {% else %}
      <p>No actions needed. You are up to date!</p>
    {% endif %}

    <!-- Tag Cloud -->

  </div>
{% endblock extra %}
